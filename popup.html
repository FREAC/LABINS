<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    <title>Intro to popups - 4.9</title>

    <style>
        html,
        body,
        #viewDiv {
            padding: 0;
            margin: 0;
            height: 100%;
            width: 100%;
        }
    </style>

    <link rel="stylesheet" href="https://js.arcgis.com/4.9/esri/css/main.css">
    <script src="https://js.arcgis.com/4.9/"></script>

    <script>
        require([
            "esri/Map",
            "esri/views/MapView",
            "esri/layers/MapImageLayer",
            "esri/tasks/IdentifyTask",
            "esri/tasks/support/IdentifyParameters"
        ], function (
            Map,
            MapView,
            MapImageLayer,
            IdentifyTask,
            IdentifyParameters
        ) {

            const labinsURL =
                "https://maps.freac.fsu.edu/arcgis/rest/services/LABINS/LABINS_Data/MapServer/";
            const labinsLayer = new MapImageLayer({
                url: labinsURL,
                sublayers: [{
                    id: 9,
                    title: "USGS Quads",
                    visible: true,
                    popupEnabled: true,
                    popupTemplate: {
                        title: "USGS Quads",
                        content: "<b>Name:</b> {tile_name}"
                    }
                }, {
                    id: 12,
                    title: "City Limits",
                    visible: true,
                    popupEnabled: true,
                    popupTemplate: {
                        title: "City Limits",
                        content: "<b>Name:</b> {name}"
                    }
                }]
            });

            // Create the Map
            var map = new Map({
                basemap: "streets-navigation-vector",
                layers: [labinsLayer]
            });

            // Create the MapView
            var view = new MapView({
                container: "viewDiv",
                map: map,
                center: [-84.2, 28.4],
                zoom: 6
            });


            let identifyTask, params

            view.when(function () {
                view.on("click", executeIdentifyTask);

                // Create identify task for the specified map service
                identifyTask = new IdentifyTask(labinsURL);

                // Set the parameters for the Identify
                params = new IdentifyParameters();
                params.tolerance = 3;
                params.layerIds = [9, 12];
                params.layerOption = "all";
                params.width = view.width;
                params.height = view.height;
            });


            // Executes each time the view is clicked
            function executeIdentifyTask(event) {
                // Set the geometry to the location of the view click
                params.geometry = event.mapPoint;
                params.mapExtent = view.extent;
                document.getElementById("viewDiv").style.cursor = "wait";

                identifyTask.execute(params)
                    .then(function (response) {
                        let results = response.results;
                    })

            }
        });
    </script>
</head>

<body>
    <div id="viewDiv"></div>
</body>

</html>